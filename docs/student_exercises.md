# AI建築設計 実践演習ガイド

## 🎯 演習の目的

本演習では、AI技術（特に粒子群最適化：PSO）とFEM構造解析を組み合わせた建築設計システムを使用し、パラメータ探索を通じて以下を学びます：

1. **設計パラメータと建築性能の関係を理解する**
2. **構造安全性と経済性のトレードオフを体験する**
3. **環境配慮型設計の実践的アプローチを習得する**
4. **データに基づく設計意思決定プロセスを学ぶ**

---

## 🛠️ 事前準備

### 必要なソフトウェア
- **FreeCAD** 0.21以上（3D CADソフトウェア）
- **Python** 3.8以上
- **CalculiX** （FEM解析ソルバー、FreeCADに含まれる）
- **テキストエディタ** （VSCode、Notepad++等）

### 必要なファイル
```
📁 作業ディレクトリ/
├── 📄 test_generate_building.py      # メインスクリプト
├── 📄 generate_building_fem_analyze.py # 解析モジュール
├── 📄 pso_config.py                   # 最適化設定（発展課題用）
└── 📁 output/                         # 出力ディレクトリ（自動生成）
```

### 基本実行コマンド
```bash
# macOS/Linux
/Applications/FreeCAD.app/Contents/Resources/bin/freecadcmd test_generate_building.py

# Windows
"C:\Program Files\FreeCAD\bin\FreeCADCmd.exe" test_generate_building.py
```

---

## 📚 演習課題

### 【Level 1】基礎理解編 - パラメータの影響を理解する

#### 演習1-1: 建物サイズと構造性能の関係

**🎯 学習目標：** 建物の大きさが構造安全性と経済性にどう影響するかを理解する

**📊 実験手順：**

1. `test_generate_building.py`の33-38行目を編集し、以下の3パターンを実行：

```python
# パターンA：小規模住宅（6m×6m）
default_params = {
    'Lx': 6.0,  'Ly': 6.0,
    'H1': 3.0,  'H2': 3.0,
    # 他のパラメータは変更しない
}

# パターンB：中規模建築（10m×10m）
default_params = {
    'Lx': 10.0, 'Ly': 10.0,
    'H1': 3.0,  'H2': 3.0,
}

# パターンC：大規模建築（15m×15m）
default_params = {
    'Lx': 15.0, 'Ly': 15.0,
    'H1': 3.0,  'H2': 3.0,
}
```

**📝 データ記録表：**

| 建物規模 | 床面積(m²) | 安全率 | 建設コスト(円/m²) | 快適性スコア | 最大変位(mm) |
|----------|------------|--------|-------------------|--------------|--------------|
| 小規模   |            |        |                   |              |              |
| 中規模   |            |        |                   |              |              |
| 大規模   |            |        |                   |              |              |

**💡 考察のヒント：**
- なぜ建物が大きくなると安全率が変化するのか？
- スケールメリットは建設コストに現れているか？
- 快適性スコアの変化要因は何か？

---

#### 演習1-2: 構造部材寸法の最適化

**🎯 学習目標：** 柱・梁・スラブの寸法が構造性能とコストに与える影響を定量化する

**📊 実験手順：**

柱サイズを段階的に変更し、安全率2.0を達成する最小寸法を見つける：

```python
# test_generate_building.pyの41-44行目を編集

# Step 1: 細い柱（構造的に不十分）
'bc': 200,  # 柱幅 200mm
'hc': 200,  # 柱高さ 200mm

# Step 2: 標準的な柱
'bc': 400,  # 柱幅 400mm
'hc': 400,  # 柱高さ 400mm

# Step 3: 太い柱（過剰設計）
'bc': 600,  # 柱幅 600mm
'hc': 600,  # 柱高さ 600mm
```

**📈 グラフ作成：**
- X軸：柱断面積（mm²）
- Y軸1：安全率（左軸）
- Y軸2：建設コスト（右軸）

**💭 設計判断の練習：**
「安全率2.0を確保しつつ、最もコスト効率の良い柱寸法は？」

---

### 【Level 2】応用編 - 材料選択と環境性能

#### 演習2-1: ハイブリッド構造の探求

**🎯 学習目標：** コンクリートと木材の適材適所な使い分けを学ぶ

**🌱 環境配慮の観点：**

```python
# test_generate_building.pyの56-62行目を編集

# 構造A：従来型RC造（全コンクリート）
material_params = {
    'material_columns': 0,    # 0=コンクリート
    'material_floor1': 0,
    'material_floor2': 0,
    'material_roof': 0,
    'material_walls': 0,
    'material_balcony': 0
}

# 構造B：ハイブリッド構造（最適配置）
material_params = {
    'material_columns': 0,    # 柱：コンクリート（高強度）
    'material_floor1': 0,     # 1階床：コンクリート（基礎）
    'material_floor2': 1,     # 2階床：木材（軽量化）
    'material_roof': 1,       # 屋根：木材（断熱性）
    'material_walls': 1,      # 壁：木材（環境性）
    'material_balcony': 0     # バルコニー：コンクリート（耐候性）
}

# 構造C：木造建築（全木材/CLT）
material_params = {
    'material_columns': 1,    # 1=木材（CLT）
    'material_floor1': 1,
    'material_floor2': 1,
    'material_roof': 1,
    'material_walls': 1,
    'material_balcony': 1
}
```

**📊 環境性能比較表：**

| 構造タイプ | CO2排出量(kg-CO2/m²) | RC造比削減率(%) | 安全率 | 建設コスト | 重量(ton) |
|------------|---------------------|-----------------|--------|------------|-----------|
| RC造       |                     | 基準(0%)        |        |            |           |
| ハイブリッド|                     |                 |        |            |           |
| 木造       |                     |                 |        |            |           |

**🏆 チャレンジ課題：**
「CO2排出量を30%削減しながら、安全率2.0を維持する材料組み合わせを見つけよ」

---

#### 演習2-2: 特殊形状による構造性能向上

**🎯 学習目標：** 建築形状が構造性能に与える影響を視覚的・定量的に理解する

**🏗️ 形状実験：**

```python
# 壁傾斜角度の実験（48行目）
wall_configs = [
    {'angle': -15, 'name': '内傾斜（台形）'},
    {'angle': 0,   'name': '垂直壁（標準）'},
    {'angle': 15,  'name': '外傾斜（逆台形）'}
]

# 屋根形状の実験（50-51行目）
roof_configs = [
    {'morph': 0.0, 'shift': 0.0, 'name': 'フラット'},
    {'morph': 1.0, 'shift': 0.0, 'name': '対称アーチ'},
    {'morph': 0.8, 'shift': 0.5, 'name': '非対称シェル'}
]
```

**📸 3Dモデル比較：**
1. 各形状のFCStdファイルを生成
2. FreeCAD GUIで開いて視覚化
3. 構造的特徴をスケッチで記録
4. 応力分布の違いを観察

---

### 【Level 3】実践編 - 制約条件下での最適設計

#### 演習3-1: 実プロジェクトシミュレーション

**🎯 学習目標：** 実際の建築プロジェクトで直面する複数の制約条件を満たす設計を見つける

**📋 プロジェクト要求仕様：**

```markdown
【必須要件】
✅ 延床面積：100m²以上（2階建て）
✅ 構造安全率：2.0以上（建築基準法準拠）
✅ 建設予算：300,000円/m²以下
✅ 環境基準：CO2排出量 500 kg-CO2/m²以下

【希望要件】
⭐ 快適性スコア：7.0以上
⭐ 施工性スコア：6.0以上
⭐ バルコニー付き（奥行1.5m以上）
```

**🔄 最適化プロセス記録：**

```python
# 試行記録テンプレート
iteration_log = {
    '試行': 1,
    '変更内容': 'Lxを8→9mに拡大',
    '結果': {
        '床面積': 81,
        '安全率': 1.85,  # ❌ 不足
        'コスト': 285000,  # ✅ OK
        'CO2': 480,  # ✅ OK
    },
    '判定': '安全率不足→柱サイズ増が必要'
}
```

---

#### 演習3-2: 多目的最適化チャレンジ

**🎯 学習目標：** 異なるステークホルダーの要求に応える複数の設計案を作成する

**👥 3つのシナリオ：**

### シナリオA：投資家向け（経済性重視）
```python
optimization_weights = {
    'safety': 0.2,     # 必須要件（最低限）
    'cost': 0.5,       # 最重要
    'environment': 0.1,
    'comfort': 0.1,
    'constructability': 0.1
}
```

### シナリオB：環境団体向け（サステナビリティ重視）
```python
optimization_weights = {
    'safety': 0.2,
    'cost': 0.1,
    'environment': 0.5,  # 最重要
    'comfort': 0.1,
    'constructability': 0.1
}
```

### シナリオC：エンドユーザー向け（快適性重視）
```python
optimization_weights = {
    'safety': 0.2,
    'cost': 0.15,
    'environment': 0.15,
    'comfort': 0.4,     # 最重要
    'constructability': 0.1
}
```

**📊 比較分析：**
各シナリオの最適解をレーダーチャートで可視化し、トレードオフを明確化

---

### 【Level 4】発展編 - PSO自動最適化の活用

#### 演習4-1: PSO設定のカスタマイズ

**🎯 学習目標：** 粒子群最適化アルゴリズムの動作原理を理解し、問題に応じた調整を行う

**⚙️ PSO設定ファイル（pso_config.py）の編集：**

```python
# 最適化パラメータ
N_PARTICLES = 20      # 粒子数（探索の並列度）
MAX_ITER = 30        # 反復回数（探索の深さ）

# 設計変数の範囲設定
BOUNDS = {
    'Lx': (6.0, 15.0),      # X方向長さの探索範囲
    'Ly': (6.0, 15.0),      # Y方向長さの探索範囲
    'bc': (200, 600),       # 柱サイズの探索範囲
    'material_columns': (0.0, 1.0),  # 材料選択（0=コンクリート、1=木材）
    # ... 他のパラメータ
}

# 評価関数の重み付け
def calculate_fitness(evaluation):
    """カスタム評価関数"""
    # 安全率が2.0未満はペナルティ
    if evaluation['safety'] < 2.0:
        return 1e10  # 極大値（不適解）
    
    # 重み付き総合評価
    fitness = (
        0.3 * evaluation['cost'] / 300000 +        # コスト（正規化）
        0.3 * evaluation['co2'] / 500 +            # CO2（正規化）
        0.2 * (10 - evaluation['comfort']) / 10 +  # 快適性（逆数）
        0.2 * (10 - evaluation['constructability']) / 10
    )
    return fitness
```

**🚀 実行と監視：**

```bash
# PSO実行
freecadcmd pso_algorithm.py

# 別ターミナルで監視
python monitor_pso_win.py  # Windows
python monitor_pso_mac.py  # macOS

# ブラウザで確認
http://localhost:5001
```

---

## 📝 レポート作成ガイド

### 推奨レポート構成（A4 6-8ページ）

#### 1. はじめに（0.5ページ）
- 建築設計における最適化の重要性
- AI技術（PSO）の役割
- 本演習の目的と範囲

#### 2. 方法論（1ページ）
- 使用システムの概要（フローチャート推奨）
- 評価指標の定義と計算方法
- 実験条件と変数の説明

#### 3. 実験結果（3-4ページ）

##### 3.1 基礎実験の結果
- パラメータ感度分析の表とグラフ
- 代表的な3Dモデルの画像（最低3種類）

##### 3.2 応用実験の結果
- 材料組み合わせの比較表
- 形状変化による性能変化のグラフ

##### 3.3 最適化の結果
- 制約条件を満たす設計案の詳細
- PSO収束グラフ（発展課題実施の場合）

#### 4. 考察（1.5-2ページ）
- **発見した設計原則**
  - どのパラメータが最も影響力があったか？
  - なぜその結果になったのか？（物理的な理由）
  
- **トレードオフ分析**
  - 相反する要求のバランス点
  - 実用的な妥協案の提案

- **実装上の課題と解決策**
  - 遭遇した問題と対処法
  - システムの改善提案

#### 5. 結論（0.5ページ）
- 主要な発見のまとめ（3点以内）
- 実務への応用可能性
- 今後の研究課題

#### 6. 参考文献
- 使用したドキュメント
- 参考にした論文や書籍

### 図表作成のヒント

**効果的なグラフの例：**

```python
import matplotlib.pyplot as plt
import numpy as np

# 2軸グラフの作成（安全率とコスト）
fig, ax1 = plt.subplots(figsize=(10, 6))

ax1.set_xlabel('柱断面積 (mm²)')
ax1.set_ylabel('安全率', color='tab:blue')
ax1.plot(areas, safety_factors, 'b-o', label='安全率')
ax1.axhline(y=2.0, color='b', linestyle='--', alpha=0.5, label='安全基準')
ax1.tick_params(axis='y', labelcolor='tab:blue')

ax2 = ax1.twinx()
ax2.set_ylabel('建設コスト (円/m²)', color='tab:red')
ax2.plot(areas, costs, 'r-s', label='コスト')
ax2.tick_params(axis='y', labelcolor='tab:red')

plt.title('柱断面積と構造性能・コストの関係')
plt.grid(True, alpha=0.3)
fig.tight_layout()
plt.show()
```

---

## 📊 評価基準

### 配点表（100点満点）

| 評価項目 | 配点 | 評価の観点 |
|----------|------|------------|
| **実験の完成度** | 30点 | ・全課題の実施<br>・データの完全性<br>・手順の正確性 |
| **データ分析** | 25点 | ・適切な統計処理<br>・グラフの見やすさ<br>・比較の妥当性 |
| **考察の深さ** | 25点 | ・物理的根拠の説明<br>・トレードオフの理解<br>・独自の発見 |
| **レポートの質** | 15点 | ・構成の論理性<br>・図表の効果的使用<br>・文章の明確性 |
| **創造性** | 5点 | ・独自の実験設計<br>・新しい知見<br>・改善提案 |

### 評価レベル

- **S（90点以上）**: 全課題を完璧に実施し、独自の発見や深い考察がある
- **A（80-89点）**: 必須課題を完了し、データ分析と考察が優れている
- **B（70-79点）**: 基本課題を完了し、適切な分析ができている
- **C（60-69点）**: 最低限の課題を完了している
- **D（60点未満）**: 課題の完成度が不十分

---

## 🆘 トラブルシューティング

### よくある問題と解決策

#### 問題1：FreeCADが起動しない
```bash
# パスを確認
which freecadcmd  # macOS/Linux
where freecadcmd  # Windows

# 直接フルパスで実行
/usr/local/bin/freecadcmd test_generate_building.py
```

#### 問題2：計算時間が長すぎる
```python
# 解決策：メッシュサイズを大きくする
# generate_building_fem_analyze.pyの該当行を編集
mesh.CharacteristicLengthMax = 500  # デフォルト300から増加
```

#### 問題3：安全率が異常値になる
```python
# デバッグモード有効化
VERBOSE_OUTPUT = True  # generate_building_fem_analyze.pyの先頭

# ログファイルを確認
tail -f output/debug.log
```

#### 問題4：メモリ不足エラー
- 建物サイズを小さくする（Lx, Ly < 10m）
- 同時実行プロセスを減らす
- メッシュ品質を下げる

---

## 📚 参考資料・リンク

### 技術ドキュメント
- [FreeCAD Python API](https://wiki.freecad.org/Python_scripting_tutorial)
- [CalculiX Documentation](http://www.calculix.de/documentation/)
- [PSO Algorithm Overview](https://en.wikipedia.org/wiki/Particle_swarm_optimization)

### 建築基準・規格
- 建築基準法における構造安全率の規定
- 木造建築設計基準（CLT）
- 環境性能評価基準（CASBEE）

### 推奨学習リソース
- 構造力学の基礎（静定構造物）
- 有限要素法入門
- 最適化アルゴリズムの基礎

---

## ✅ 提出前チェックリスト

### 必須提出物
- [ ] **実験データファイル**（Excel or CSV形式）
  - 全実験の生データ
  - 計算過程が分かる数式
  
- [ ] **レポート**（PDF形式、6-8ページ）
  - 指定フォーマットに従っているか
  - 図表番号と本文の参照が一致
  
- [ ] **代表的FCStdファイル**（3-5個）
  - 最適解
  - 比較用の典型例
  - 特徴的な形状
  
- [ ] **プログラムファイル**（編集した場合）
  - コメント付きの変更箇所
  - 実行手順のREADME

### オプション提出物
- [ ] 3Dモデルのレンダリング画像
- [ ] 追加実験の結果
- [ ] 改善提案書

### 提出方法
- **期限**: 演習実施から2週間以内
- **形式**: ZIPファイルにまとめて提出
- **命名規則**: `学籍番号_氏名_AI建築演習.zip`
- **提出先**: 指定のLMSまたはメールアドレス

---

## 💡 成功のヒント

1. **段階的に進める** - 基礎課題から順番に、理解を深めながら進む
2. **データを整理する** - Excelで実験記録表を作り、随時更新
3. **視覚化を活用** - グラフや3Dモデルで直感的理解を深める
4. **仮説を立てる** - 実験前に結果を予想し、検証する
5. **協力する** - クラスメートと結果を比較し、議論する

---

*最終更新: 2025年8月*
*作成: AI建築設計演習チーム*