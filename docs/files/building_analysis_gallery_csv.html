<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å»ºç¯‰ç‰©FEMè§£æã‚®ãƒ£ãƒ©ãƒªãƒ¼ (CSVç‰ˆ)</title>
    <!-- Papa Parse ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #666;
        }
        .error {
            background-color: #fee;
            border: 1px solid #fcc;
            color: #c00;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .sort-controls {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        .sort-controls h3 {
            margin: 0 0 10px 0;
            font-size: 1.1em;
            color: #2c3e50;
        }
        .sort-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .sort-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background-color: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .sort-btn:hover {
            background-color: #e9ecef;
            border-color: #adb5bd;
        }
        .sort-btn.active {
            background-color: #2c3e50;
            color: white;
            border-color: #2c3e50;
        }
        .sort-arrow {
            font-size: 0.8em;
            opacity: 0.6;
        }
        .sort-btn.active .sort-arrow {
            opacity: 1;
        }
        .sample-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            padding: 15px;
            overflow: hidden;
        }
        .sample-header {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            margin: -15px -15px 15px -15px;
            font-size: 1em;
            font-weight: bold;
        }
        .content-wrapper {
            display: grid;
            grid-template-columns: 0.5fr 2fr;
            gap: 15px;
        }
        .left-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .parameters-section {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
        }
        .evaluation-section {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
        }
        .images-grid-2x2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
        }
        .section-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.65em;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }
        .data-table td {
            border: 1px solid #e0e0e0;
            padding: 2px 5px;
        }
        .data-table td:first-child {
            color: #666;
            background-color: #f9f9f9;
        }
        .data-table td:last-child {
            font-weight: 500;
            color: #333;
            text-align: right;
        }
        .data-table tr.material-separator td {
            border-bottom: 2px solid #666;
        }
        .image-wrapper {
            display: flex;
            flex-direction: column;
        }
        .image-container {
            position: relative;
            background-color: #f0f0f0;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
            aspect-ratio: 5/3;
        }
        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }
        .image-label {
            background-color: #333;
            color: white;
            padding: 4px;
            text-align: center;
            font-size: 0.7em;
            border-radius: 0 0 8px 8px;
            margin-top: 0;
        }
        .safety-factor {
            color: #28a745;
            font-weight: bold;
        }
        .safety-factor.low {
            color: #dc3545;
        }
        .safety-factor.medium {
            color: #ffc107;
        }
        .sort-status-asc {
            color: #2196F3;
            font-weight: bold;
        }
        .sort-status-desc {
            color: #FF5722;
            font-weight: bold;
        }
        .data-table td.sort-status-asc {
            color: #2196F3 !important;
            font-weight: bold;
        }
        .data-table td.sort-status-desc {
            color: #FF5722 !important;
            font-weight: bold;
        }
        .pattern-badge {
            display: inline-block;
            background-color: #e3f2fd;
            color: #1976d2;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            margin-top: 5px;
        }
        .no-image {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            font-size: 0.9em;
        }
        .data-count {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        @media (max-width: 768px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
            .images-grid-2x2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ï¸ å»ºç¯‰ç‰©FEMè§£æã‚®ãƒ£ãƒ©ãƒªãƒ¼ <span style="font-size: 0.8em;">(CSVç‰ˆ)</span></h1>
        
        <div id="loading" class="loading">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        <div id="error" class="error" style="display: none;"></div>
        <div id="dataCount" class="data-count" style="display: none;"></div>
        
        <div class="sort-controls" style="display: none;" id="sortControls">
            <h3>ä¸¦ã³æ›¿ãˆ</h3>
            <div id="currentSortStatus" style="margin-bottom: 10px; font-size: 0.9em; color: #666;"></div>
            <div class="sort-buttons">
                <button class="sort-btn" data-sort="cost" data-order="asc">
                    ğŸ’° ã‚³ã‚¹ãƒˆ <span class="sort-arrow">â–²</span>
                </button>
                <button class="sort-btn" data-sort="co2" data-order="asc">
                    ğŸŒ± CO2æ’å‡ºé‡ <span class="sort-arrow">â–²</span>
                </button>
                <button class="sort-btn" data-sort="comfort" data-order="desc">
                    ğŸ˜Š å¿«é©æ€§ <span class="sort-arrow">â–¼</span>
                </button>
                <button class="sort-btn" data-sort="constructability" data-order="desc">
                    ğŸ”¨ æ–½å·¥æ€§ <span class="sort-arrow">â–¼</span>
                </button>
                <button class="sort-btn" data-sort="safety" data-order="desc">
                    ğŸ›¡ï¸ å®‰å…¨ç‡ <span class="sort-arrow">â–¼</span>
                </button>
                <button class="sort-btn" data-sort="area" data-order="desc">
                    ğŸ“ åºŠé¢ç© <span class="sort-arrow">â–¼</span>
                </button>
                <button class="sort-btn" data-sort="total_cost" data-order="asc">
                    ğŸ’´ ç·å·¥è²» <span class="sort-arrow">â–²</span>
                </button>
            </div>
        </div>

        <div id="samples-container"></div>
    </div>

    <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let allSamples = [];
    let currentSort = null;
    let currentOrder = null;
    
    // ã‚½ãƒ¼ãƒˆé …ç›®ã®æ—¥æœ¬èªå
    const sortLabels = {
        cost: 'ã‚³ã‚¹ãƒˆ',
        co2: 'CO2æ’å‡ºé‡',
        comfort: 'å¿«é©æ€§',
        constructability: 'æ–½å·¥æ€§',
        safety: 'å®‰å…¨ç‡',
        area: 'åºŠé¢ç©',
        total_cost: 'ç·å·¥è²»'
    };

    // CSVãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
    Papa.parse('production_freecad_random_fem_evaluation.csv', {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
            console.log('CSVãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', results.data.length, 'ä»¶');
            
            // nanã‚„ã‚¨ãƒ©ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’é™¤å¤–ã—ã€fcstd_pathã‹ã‚‰å®Ÿéš›ã®ã‚µãƒ³ãƒ—ãƒ«ç•ªå·ã‚’æŠ½å‡º
            const validData = results.data
                .map((row, index) => {
                    // fcstd_pathã‹ã‚‰å®Ÿéš›ã®ã‚µãƒ³ãƒ—ãƒ«ç•ªå·ã‚’æŠ½å‡º
                    if (row.fcstd_path) {
                        const match = row.fcstd_path.match(/sample(\d+)\.FCStd/);
                        row.actualSampleNumber = match ? parseInt(match[1]) : index + 1;
                    } else {
                        row.actualSampleNumber = index + 1;
                    }
                    return row;
                })
                .filter(row => {
                    return row.safety_factor && 
                           !isNaN(parseFloat(row.safety_factor)) &&
                           row.safety_factor !== 'nan';
                });
            
            console.log('æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿:', validData.length, 'ä»¶');
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
            allSamples = validData;
            
            // UIã‚’æ›´æ–°
            document.getElementById('loading').style.display = 'none';
            document.getElementById('sortControls').style.display = 'block';
            document.getElementById('dataCount').style.display = 'block';
            document.getElementById('dataCount').textContent = `ãƒ‡ãƒ¼ã‚¿ä»¶æ•°: ${validData.length}ä»¶`;
            
            // ã‚µãƒ³ãƒ—ãƒ«ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
            displaySamples(validData);
            
            // åˆæœŸã®ã‚½ãƒ¼ãƒˆçŠ¶æ…‹ã‚’è¡¨ç¤º
            updateSortStatus(null, null);
            
            // ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’è¨­å®š
            setupSortButtons();
        },
        error: function(error) {
            console.error('CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            document.getElementById('loading').style.display = 'none';
            const errorDiv = document.getElementById('error');
            errorDiv.style.display = 'block';
            errorDiv.innerHTML = `
                <h3>ã‚¨ãƒ©ãƒ¼: CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</h3>
                <p>${error.message || 'ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚'}</p>
                <p>HTTPã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
            `;
        }
    });

    // ã‚µãƒ³ãƒ—ãƒ«ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
    function displaySamples(samples) {
        const container = document.getElementById('samples-container');
        container.innerHTML = '';
        
        samples.forEach((sample) => {
            // actualSampleNumberã‚’ä½¿ç”¨ï¼ˆfcstd_pathã‹ã‚‰æŠ½å‡ºã—ãŸå®Ÿéš›ã®ã‚µãƒ³ãƒ—ãƒ«ç•ªå·ï¼‰
            const card = createSampleCard(sample, sample.actualSampleNumber);
            container.appendChild(card);
        });
    }

    // ã‚µãƒ³ãƒ—ãƒ«ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆ
    function createSampleCard(sample, sampleNumber) {
        const card = document.createElement('div');
        card.className = 'sample-card';
        card.dataset.cost = sample.cost_per_sqm || 0;
        card.dataset.co2 = sample.co2_per_sqm || 0;
        card.dataset.comfort = sample.comfort_score || 0;
        card.dataset.constructability = sample.constructability_score || 0;
        card.dataset.safety = sample.safety_factor || 0;
        card.dataset.area = sample.floor_area || 0;
        card.dataset.total_cost = sample.total_cost || 0;
        
        // æ§‹é€ ã‚¿ã‚¤ãƒ—ã®åˆ¤å®š
        const structureType = getStructureType(sample);
        
        // å®‰å…¨ç‡ã®ã‚¯ãƒ©ã‚¹åˆ¤å®š
        const safetyClass = parseFloat(sample.safety_factor) < 1.5 ? 'low' : 
                           parseFloat(sample.safety_factor) < 2.0 ? 'medium' : '';
        
        // ã‚½ãƒ¼ãƒˆçŠ¶æ…‹ã®æ–‡å­—åˆ—ã‚’ç”Ÿæˆ
        let sortStatusHtml = '';
        if (currentSort) {
            const orderClass = currentOrder === 'asc' ? 'sort-status-asc' : 'sort-status-desc';
            const orderText = currentOrder === 'asc' ? 'æ˜‡é †' : 'é™é †';
            sortStatusHtml = ` - ç¾åœ¨ã®ã‚½ãƒ¼ãƒˆ: <span class="${orderClass}">${sortLabels[currentSort]}ï¼ˆ${orderText}ï¼‰</span>`;
        }
        
        card.innerHTML = `
            <div class="sample-header">
                SAMPLE${sampleNumber} - ${structureType}${sortStatusHtml}
            </div>
            
            <div class="content-wrapper">
                <div class="left-section">
                    <div class="parameters-section">
                        <div class="section-title">ğŸ“ è¨­è¨ˆå¤‰æ•°</div>
                        <table class="data-table">
                            <tr>
                                <td>å»ºç‰©å¹… (Lx)</td>
                                <td>${parseFloat(sample.Lx).toFixed(2)} m</td>
                            </tr>
                            <tr>
                                <td>å»ºç‰©å¥¥è¡Œ (Ly)</td>
                                <td>${parseFloat(sample.Ly).toFixed(2)} m</td>
                            </tr>
                            <tr>
                                <td>1éšé«˜ (H1)</td>
                                <td>${parseFloat(sample.H1).toFixed(2)} m</td>
                            </tr>
                            <tr>
                                <td>2éšé«˜ (H2)</td>
                                <td>${parseFloat(sample.H2).toFixed(2)} m</td>
                            </tr>
                            <tr>
                                <td>åºŠã‚¹ãƒ©ãƒ–åš (tf)</td>
                                <td>${Math.round(parseFloat(sample.tf))} mm</td>
                            </tr>
                            <tr>
                                <td>å±‹æ ¹ã‚¹ãƒ©ãƒ–åš (tr)</td>
                                <td>${Math.round(parseFloat(sample.tr))} mm</td>
                            </tr>
                            <tr>
                                <td>æŸ±å¹… (bc)</td>
                                <td>${Math.round(parseFloat(sample.bc))} mm</td>
                            </tr>
                            <tr>
                                <td>æŸ±åš (hc)</td>
                                <td>${Math.round(parseFloat(sample.hc))} mm</td>
                            </tr>
                            <tr>
                                <td>å¤–å£åš (tw_ext)</td>
                                <td>${Math.round(parseFloat(sample.tw_ext))} mm</td>
                            </tr>
                            <tr>
                                <td>å£å‚¾æ–œè§’åº¦</td>
                                <td>${parseFloat(sample.wall_tilt_angle || 0).toFixed(1)}Â°</td>
                            </tr>
                            <tr>
                                <td>çª“é–‹å£ç‡</td>
                                <td>${parseFloat(sample.window_ratio_2f || 0).toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>å±‹æ ¹å½¢æ…‹</td>
                                <td>${parseFloat(sample.roof_morph || 0).toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>å±‹æ ¹ã‚·ãƒ•ãƒˆ</td>
                                <td>${parseFloat(sample.roof_shift || 0).toFixed(2)}</td>
                            </tr>
                            <tr class="material-separator">
                                <td>ãƒãƒ«ã‚³ãƒ‹ãƒ¼å¥¥è¡Œ</td>
                                <td>${parseFloat(sample.balcony_depth || 0).toFixed(1)} m</td>
                            </tr>
                            <tr>
                                <td>æŸ±ææ–™</td>
                                <td>${sample.material_columns == 2 ? 'CLT' : sample.material_columns == 1 ? 'æœ¨æ' : 'ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆ'}</td>
                            </tr>
                            <tr>
                                <td>1éšåºŠææ–™</td>
                                <td>${sample.material_floor1 == 2 ? 'CLT' : sample.material_floor1 == 1 ? 'æœ¨æ' : 'ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆ'}</td>
                            </tr>
                            <tr>
                                <td>2éšåºŠææ–™</td>
                                <td>${sample.material_floor2 == 2 ? 'CLT' : sample.material_floor2 == 1 ? 'æœ¨æ' : 'ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆ'}</td>
                            </tr>
                            <tr>
                                <td>å±‹æ ¹ææ–™</td>
                                <td>${sample.material_roof == 2 ? 'CLT' : sample.material_roof == 1 ? 'æœ¨æ' : 'ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆ'}</td>
                            </tr>
                            <tr>
                                <td>å¤–å£ææ–™</td>
                                <td>${sample.material_walls == 2 ? 'CLT' : sample.material_walls == 1 ? 'æœ¨æ' : 'ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆ'}</td>
                            </tr>
                            <tr>
                                <td>ãƒãƒ«ã‚³ãƒ‹ãƒ¼ææ–™</td>
                                <td>${sample.material_balcony == 2 ? 'CLT' : sample.material_balcony == 1 ? 'æœ¨æ' : 'ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆ'}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="evaluation-section">
                        <div class="section-title">ğŸ“Š è©•ä¾¡çµæœ</div>
                        <table class="data-table">
                            <tr>
                                <td${currentSort === 'safety' ? ` class="${currentOrder === 'asc' ? 'sort-status-asc' : 'sort-status-desc'}"` : ''}>å®‰å…¨ç‡</td>
                                <td class="safety-factor ${safetyClass}">${parseFloat(sample.safety_factor).toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td${currentSort === 'cost' ? ` class="${currentOrder === 'asc' ? 'sort-status-asc' : 'sort-status-desc'}"` : ''}>å»ºè¨­ã‚³ã‚¹ãƒˆ</td>
                                <td>Â¥${Math.round(parseFloat(sample.cost_per_sqm)).toLocaleString()}/mÂ²</td>
                            </tr>
                            <tr>
                                <td${currentSort === 'co2' ? ` class="${currentOrder === 'asc' ? 'sort-status-asc' : 'sort-status-desc'}"` : ''}>CO2æ’å‡ºé‡</td>
                                <td>${parseFloat(sample.co2_per_sqm).toFixed(1)} kg/mÂ²</td>
                            </tr>
                            <tr>
                                <td${currentSort === 'comfort' ? ` class="${currentOrder === 'asc' ? 'sort-status-asc' : 'sort-status-desc'}"` : ''}>å¿«é©æ€§ã‚¹ã‚³ã‚¢</td>
                                <td>${parseFloat(sample.comfort_score).toFixed(1)}/10</td>
                            </tr>
                            <tr>
                                <td${currentSort === 'constructability' ? ` class="${currentOrder === 'asc' ? 'sort-status-asc' : 'sort-status-desc'}"` : ''}>æ–½å·¥æ€§ã‚¹ã‚³ã‚¢</td>
                                <td>${parseFloat(sample.constructability_score).toFixed(1)}/10</td>
                            </tr>
                            <tr>
                                <td${currentSort === 'area' ? ` class="${currentOrder === 'asc' ? 'sort-status-asc' : 'sort-status-desc'}"` : ''}>åºŠé¢ç©</td>
                                <td>${parseFloat(sample.floor_area).toFixed(1)} mÂ²</td>
                            </tr>
                            <tr>
                                <td${currentSort === 'total_cost' ? ` class="${currentOrder === 'asc' ? 'sort-status-asc' : 'sort-status-desc'}"` : ''}>ç·å·¥è²»</td>
                                <td>Â¥${Math.round(parseFloat(sample.total_cost)/10000).toLocaleString()}ä¸‡</td>
                            </tr>
                        </table>
                        <div class="pattern-badge">SAMPLE${sampleNumber}</div>
                    </div>
                </div>
                
                <div class="images-grid-2x2">
                    ${generateImageHTML(sampleNumber)}
                </div>
            </div>
        `;
        
        return card;
    }

    // æ§‹é€ ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š
    function getStructureType(sample) {
        // design_patternãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨
        if (sample.design_pattern) {
            return sample.design_pattern;
        }
        
        // design_patternãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒãªã„å ´åˆã¯è¨ˆç®—
        const area = parseFloat(sample.floor_area);
        const slabThickness = parseFloat(sample.tf);
        const H1 = parseFloat(sample.H1);
        
        let size = area < 100 ? 'å°å‹' : area < 200 ? 'ä¸­å‹' : 'å¤§å‹';
        let structure = slabThickness > 300 ? 'é‡æ§‹é€ ' : 'æ¨™æº–æ§‹é€ ';
        let ceiling = H1 > 3.5 ? 'é«˜å¤©äº•' : 'æ¨™æº–å¤©äº•';
        
        return `${size}_${structure}_${ceiling}`;
    }

    // ç”»åƒHTMLã‚’ç”Ÿæˆ
    function generateImageHTML(sampleNumber) {
        const views = [
            { label: 'ã‚¢ã‚¤ã‚½ãƒ¡ãƒˆãƒªãƒƒã‚¯ï¼ˆå—æ±ï¼‰', suffix: '_1' },
            { label: 'æ­£é¢ï¼ˆå—ï¼‰', suffix: '_2' },
            { label: 'å´é¢ï¼ˆæ±ï¼‰', suffix: '_3' },
            { label: 'ã‚¢ã‚¤ã‚½ãƒ¡ãƒˆãƒªãƒƒã‚¯ï¼ˆåŒ—è¥¿ï¼‰', suffix: '_4' }
        ];
        
        return views.map(view => `
            <div class="image-wrapper">
                <div class="image-container">
                    <img src="png_outputs/sample${sampleNumber}${view.suffix}.png" 
                         alt="${view.label}" 
                         onerror="this.parentElement.innerHTML='<div class=\\'no-image\\'>ç”»åƒãªã—</div>'">
                </div>
                <div class="image-label">${view.label}</div>
            </div>
        `).join('');
    }

    // ã‚½ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®è¨­å®š
    function setupSortButtons() {
        const sortButtons = document.querySelectorAll('.sort-btn');
        
        sortButtons.forEach(button => {
            button.addEventListener('click', function() {
                const sortType = this.dataset.sort;
                const order = this.dataset.order;
                
                // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
                sortButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’æ›´æ–°ï¼ˆã‚½ãƒ¼ãƒˆå®Ÿè¡Œå‰ã«æ›´æ–°ï¼‰
                currentSort = sortType;
                currentOrder = order;
                
                // ã‚½ãƒ¼ãƒˆå®Ÿè¡Œ
                sortSamples(sortType, order);
                
                // ã‚½ãƒ¼ãƒˆçŠ¶æ…‹ã‚’æ›´æ–°
                updateSortStatus(sortType, order);
                
                // æ¬¡å›ã®ã‚¯ãƒªãƒƒã‚¯ã§é€†é †ã«ã™ã‚‹ãŸã‚ã€orderã‚’åè»¢
                this.dataset.order = order === 'asc' ? 'desc' : 'asc';
                this.querySelector('.sort-arrow').textContent = order === 'asc' ? 'â–¼' : 'â–²';
            });
        });
    }

    // ã‚µãƒ³ãƒ—ãƒ«ã‚’ã‚½ãƒ¼ãƒˆ
    function sortSamples(sortType, order) {
        const sortedSamples = [...allSamples].sort((a, b) => {
            let aVal, bVal;
            
            // sortTypeã«å¿œã˜ã¦é©åˆ‡ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é¸æŠ
            switch(sortType) {
                case 'cost':
                    aVal = parseFloat(a.cost_per_sqm || 0);
                    bVal = parseFloat(b.cost_per_sqm || 0);
                    break;
                case 'co2':
                    aVal = parseFloat(a.co2_per_sqm || 0);
                    bVal = parseFloat(b.co2_per_sqm || 0);
                    break;
                case 'comfort':
                    aVal = parseFloat(a.comfort_score || 0);
                    bVal = parseFloat(b.comfort_score || 0);
                    break;
                case 'constructability':
                    aVal = parseFloat(a.constructability_score || 0);
                    bVal = parseFloat(b.constructability_score || 0);
                    break;
                case 'safety':
                    aVal = parseFloat(a.safety_factor || 0);
                    bVal = parseFloat(b.safety_factor || 0);
                    break;
                case 'area':
                    aVal = parseFloat(a.floor_area || 0);
                    bVal = parseFloat(b.floor_area || 0);
                    break;
                case 'total_cost':
                    aVal = parseFloat(a.total_cost || 0);
                    bVal = parseFloat(b.total_cost || 0);
                    break;
                default:
                    aVal = 0;
                    bVal = 0;
            }
            
            if (order === 'asc') {
                return aVal - bVal;
            } else {
                return bVal - aVal;
            }
        });
        
        displaySamples(sortedSamples);
    }
    
    // ã‚½ãƒ¼ãƒˆçŠ¶æ…‹ã‚’è¡¨ç¤º
    function updateSortStatus(sortType, order) {
        const statusDiv = document.getElementById('currentSortStatus');
        
        if (!sortType) {
            statusDiv.textContent = 'ç¾åœ¨ã®ã‚½ãƒ¼ãƒˆ: ãªã—ï¼ˆå…ƒã®é †åºã§è¡¨ç¤ºï¼‰';
        } else {
            const sortLabel = sortLabels[sortType] || sortType;
            const orderLabel = order === 'asc' ? 'æ˜‡é †' : 'é™é †';
            statusDiv.textContent = `ç¾åœ¨ã®ã‚½ãƒ¼ãƒˆ: ${sortLabel}ï¼ˆ${orderLabel}ï¼‰`;
        }
    }
    </script>
</body>
</html>