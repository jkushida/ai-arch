# AI建築設計入門：課題集

## 🏗️ はじめに

この演習では、PythonとAIを活用した建築設計の自動最適化を実践的に学びます。実際に動くコードを使いながら、AIがどのように「良い建築」を見つけ出すのかを体験しましょう。

### 📚 必要な知識
- Python基礎（変数、関数、辞書の理解）
- FreeCADの基本操作
- 建築設計の基礎知識（推奨）

### 🛠️ 事前準備
1. FreeCAD 1.0.0以上のインストール
2. 必要なPythonライブラリのインストール
   ```bash
   pip install numpy pandas matplotlib tqdm flask flask-socketio
   ```
3. 提供されたコード一式をダウンロード

---

## 📋 課題1：【初級】AIによる建築最適化を体験しよう

### 🎯 学習目標
- PSOアルゴリズムによる最適化プロセスの理解
- 評価指標（安全性、コスト、環境性など）の読み方
- 最適化結果の3次元可視化

### 📝 実習手順

#### Step 1: 最適化の実行とモニタリング
```bash
# ターミナルで実行
 & "C:\Program Files\FreeCAD 1.0\bin\freecadcmd.exe" test_generate_building.py
```

実行中に観察すること：

- **ターミナル**: 反復回数、最良値の推移
- **Webブラウザ** (`http://localhost:5000`): 
  - 収束曲線の形状
  - 粒子の分布変化
  - パラメータ値の推移

#### Step 2: 最適化結果の記録
実行完了後、以下の形式で表示される最良パラメータをコピー：
```
最良パラメータ:
  Lx: 8.5432
  Ly: 7.2341
  H1: 3.2100
  ...（以下省略）
```

#### Step 3: 最適化された建物の生成

方法1: **`test_generate_building.py`を使用する場合（推奨）**

1. `test_generate_building.py`をコピーして`test_optimal_building.py`として保存
2. ファイル内の`test_parameters`リストの最初の要素を、Step 2でメモした最良パラメータに置き換え：

```python
test_parameters = [
    # 最適化で得られたパラメータに置き換え
    {
        'Lx': 8.5432,  # あなたの結果
        'Ly': 7.2341,
        'H1': 3.2100,
        'H2': 2.8500,
        'tf': 250,
        'tr': 180,
        'bc': 400,
        'hc': 400,
        'tw_ext': 200,
        'wall_tilt_angle': -5.2,
        'window_ratio_2f': 0.45,
        'roof_morph': 0.6,
        'roof_shift': 0.1,
        'balcony_depth': 1.5,
        'material_columns': 0,
        'material_floor1': 0,
        'material_floor2': 0,
        'material_roof': 1,
        'material_walls': 0,
        'material_balcony': 0
    }
]
```

3. FreeCADで実行：
```bash
# Mac
/Applications/FreeCAD.app/Contents/Resources/bin/freecadcmd test_optimal_building.py

# Windows
"C:\Program Files\FreeCAD 0.21\bin\FreeCADCmd.exe" test_optimal_building.py
```

方法2: **新規スクリプトを作成する場合**

```python
# test_optimal_building_simple.py
from generate_building_fem_analyze import evaluate_building_from_params

# Step 2でコピーしたパラメータ
params = {
    'Lx': 8.5432,  # あなたの結果に置き換え
    'Ly': 7.2341,
    # ... 全20個のパラメータ
}

# 建物の評価と3Dモデル生成
results = evaluate_building_from_params(
    params, 
    save_fcstd=True,
    fcstd_path='optimal_building.FCStd'
)

# 結果の表示
print(f"安全率: {results['safety_factor']:.2f}")
print(f"コスト: {results['cost']/1e6:.1f}百万円")
print(f"CO2排出量: {results['co2_emission']:.0f} kg-CO2")
```

#### Step 4: 3Dモデルの確認
1. FreeCADで`optimal_building.FCStd`を開く
2. 以下の視点から建物を観察：
   - 正面図（南側）
   - 側面図（東西）
   - 鳥瞰図（斜め上から）
   - 構造詳細（柱、床、屋根の接合部）

### 📊 提出課題

#### 1. 観察レポート（A4 1-2ページ）
以下の項目を含めること：

**a) 最適化プロセスの観察**
- 収束に要した反復回数
- 収束曲線の特徴（急激/緩やか、振動の有無など）
- Web UIで観察した粒子の動きの特徴

**b) 最適化された建物の特徴**
- 建物の寸法（幅、奥行き、階高）
- 構造部材の特徴（柱の太さ、床の厚さなど）
- 材料の選択（コンクリート/木材の使い分け）
- 特徴的な設計要素（傾斜壁、バルコニーなど）

**c) 評価結果の分析**
以下の表を作成し、各指標の意味を説明：

| 評価項目 | 数値 | 単位 | 評価 |
|---------|------|------|------|
| 構造安全率 | X.XX | - | 良/普通/要改善 |
| 建設コスト | XXX | 万円 | 高/標準/低 |
| CO2排出量 | XXX | kg-CO2 | 多/標準/少 |
| 快適性スコア | X.X | /10点 | 高/中/低 |
| 施工性スコア | X.X | /10点 | 易/標準/難 |

#### 2. 考察（500字以上）
- なぜAIはこの形状を「最適」と判断したのか？
- 人間の設計者との違いは何か？
- 改善の余地はあるか？

#### 3. 提出ファイル
- `optimal_building.FCStd`（3Dモデル）
- スクリーンショット（4視点以上）
- 観察レポート（PDF形式）

---

## 🔧 課題2：【中級】設計思想をAIに教えよう

### 🎯 学習目標
- 多目的最適化における重み付けの影響理解
- 評価関数のカスタマイズ手法
- 設計意図のコード化

### 📝 実習手順

#### Step 1: 3つの異なる設計思想を定義

以下の3つのシナリオから選択（または独自に定義）：

**A. 環境配慮型設計**
```python
# 目標：CO2排出量を最小化しつつ、快適性も確保
weights = {
    'safety': 10.0,   # 安全性は必須
    'cost': 0.3,      # コストは抑制
    'co2': 5.0,       # CO2を大幅削減
    'comfort': 1.0,   # 快適性も重視
    'construct': 0.2  # 施工性は最低限
}
```

**B. 高級住宅設計**
```python
# 目標：快適性と施工品質を最大化
weights = {
    'safety': 10.0,   # 安全性は必須
    'cost': 0.1,      # コストは問わない
    'co2': 0.5,       # 環境性は標準
    'comfort': 5.0,   # 快適性を最重視
    'construct': 3.0  # 施工品質も重要
}
```

**C. 経済性重視設計**
```python
# 目標：コストパフォーマンスの最大化
weights = {
    'safety': 10.0,   # 安全性は必須
    'cost': 5.0,      # コストを最重視
    'co2': 0.5,       # 環境性は標準
    'comfort': 0.3,   # 快適性は最低限
    'construct': 2.0  # 施工性で工期短縮
}
```

#### Step 2: カスタマイズと実行

1. `custom_pso_[design_name].py`として3つのファイルを作成
2. 各ファイルで異なる重み付けを設定
3. 最適化を実行（各10-20反復で十分）

#### Step 3: 結果の比較分析

比較用スプレッドシートを作成：

| 項目 | 環境配慮型 | 高級住宅 | 経済性重視 |
|------|-----------|----------|------------|
| **設計パラメータ** |
| 建物幅 (m) | | | |
| 柱サイズ (mm) | | | |
| 材料選択 | | | |
| **評価結果** |
| 安全率 | | | |
| コスト (万円) | | | |
| CO2 (kg) | | | |
| **特徴的な違い** |
| | | | |

### 📊 提出課題

#### 1. 実装レポート
- 各設計思想の詳細説明（なぜその重み付けにしたか）
- コード変更箇所（diffまたはハイライト表示）
- 実行ログ（収束状況がわかるもの）

#### 2. 比較分析レポート（A4 2-3ページ）
- 3つの建物の3Dモデル比較（同一視点でのスクリーンショット）
- 数値データの比較グラフ（レーダーチャートなど）
- 設計思想が形状に与えた影響の考察

#### 3. プレゼンテーション資料（5-10スライド）
- 各設計思想のコンセプト
- 最適化結果の視覚的比較
- 得られた知見のまとめ

---

## 🚀 課題3：【上級】新機能を実装してAIを進化させよう

### 🎯 学習目標
- システム全体のアーキテクチャ理解
- 新規機能の設計と実装
- 既存コードへの統合技術

### 📝 実装課題（以下から1つ選択）

#### Option A: 新しい構造要素の追加

**課題：「吹き抜け」機能の実装**

必要な実装：
1. パラメータ追加：
   - `void_position`: 吹き抜けの位置（0:なし、1:中央、2:階段付近）
   - `void_size`: 吹き抜けのサイズ（床面積の0-30%）

2. 3Dモデル生成の修正：
   - 2階床スラブに開口部を追加
   - 手すりの自動生成

3. 評価関数の更新：
   - 快適性スコア：吹き抜けで開放感UP
   - コスト：床面積減少but手すり追加
   - 構造安全性：開口部周辺の補強考慮

#### Option B: 新しい評価指標の追加

**課題：「防災性能」評価の実装**

必要な実装：
1. 新しい評価関数：
   ```python
   def calculate_disaster_resistance(building_info, fem_results):
       # 避難経路の評価
       # 構造の冗長性
       # 耐火性能（材料依存）
       return score
   ```

2. 避難シミュレーション：
   - 各部屋から外部への最短経路計算
   - 階段・出口の容量評価

3. 最適化への統合：
   - 重み付けへの追加
   - 制約条件の設定

#### Option C: 可視化機能の拡張

**課題：「4Dビジュアライゼーション」の実装**

必要な実装：
1. 建設プロセスアニメーション：
   - 基礎→柱→床→壁→屋根の順次表示
   - 各工程の所要時間表示

2. 最適化過程の可視化：
   - 各世代のベスト解の3Dモデル生成
   - モーフィングアニメーション

3. インタラクティブ分析：
   - パラメータスライダーでリアルタイム形状変更
   - 評価値の即時フィードバック

### 📊 提出課題

#### 1. 技術仕様書（A4 3-5ページ）
- システム設計図（UML、フローチャート等）
- API仕様（新規追加した関数の詳細）
- データフロー図

#### 2. 実装コード
- GitHubリポジトリまたはZIPファイル
- 変更履歴がわかるコミットログ
- ユニットテストコード

#### 3. デモンストレーション
- 動作を示す動画（3-5分）
- 使用方法のドキュメント
- サンプル実行結果

#### 4. 技術レポート（A4 5-8ページ）
- 実装の動機と目的
- 技術的課題と解決方法
- パフォーマンス評価
- 今後の改善案

---

## 📈 評価基準

### 初級課題（100点満点）
- 実行と観察の正確性：30点
- データ分析の深さ：30点
- 考察の論理性：30点
- レポートの完成度：10点

### 中級課題（100点満点）
- 実装の正確性：25点
- 比較分析の質：35点
- 設計意図の明確さ：25点
- プレゼンテーション：15点

### 上級課題（100点満点）
- 技術的完成度：40点
- 創造性・独自性：20点
- コード品質：20点
- ドキュメント：20点

---

## 💡 ヒントとTips

### デバッグのコツ
```python
# 詳細ログを有効化
import logging
logging.basicConfig(level=logging.DEBUG)

# 中間結果の保存
np.save('debug_particles.npy', particles_positions)
```

### パフォーマンス改善
- FEM解析を簡略化（メッシュサイズを大きく）
- 並列処理の活用（`n_jobs`パラメータ）
- 早期終了条件の設定

### トラブルシューティング
1. **メモリ不足**: 粒子数を減らす、モデルを簡略化
2. **収束しない**: 重み付けのバランスを確認
3. **エラー発生**: `fem_debug_log.txt`を確認

---

## 🔗 参考資料

- [PSO Algorithm Explanation](./PSO_algorithm_explanation.md)
- [Building FEM Analysis Report](./generate_building_fem_analyze_report.md)
- [FreeCAD Python API Documentation](https://wiki.freecad.org/Python_scripting_tutorial)
- [建築基準法の基礎知識](https://www.mlit.go.jp/jutakukentiku/build/jutakukentiku_house_tk_000085.html)

---

*最終更新: 2024年7月*